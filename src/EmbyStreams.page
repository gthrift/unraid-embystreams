Menu="Dashboard"
Icon="emby.png"
---
<style>
    /* CSS Scoped to this tile */
    #emby-streams-tile .tile-content { padding: 0; min-height: 80px; }
    #emby-streams-tile table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    #emby-streams-tile th { text-align: left; padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.1); opacity: 0.6; font-size: 1.1rem; }
    #emby-streams-tile td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    #emby-streams-tile tr:last-child td { border-bottom: none; }
    .es-icon-play { color: #8cc43c; margin-right:5px; }
    .es-icon-pause { color: #ff9900; margin-right:5px; }
</style>

<?php
$cfg = parse_ini_file("/boot/config/plugins/embystreams/embystreams.cfg");
$interval = isset($cfg['POLL_INTERVAL']) ? (int)$cfg['POLL_INTERVAL'] * 1000 : 5000;
?>

<div class="tile" id="emby-streams-tile">
    <div class="tile-header">
        <span class="tile-header-left">
            <i class="icon-emby f32"></i> <div class="section">
                <h3 class="tile-header-main">Emby Streams</h3>
            </div>
        </span>
        <span class="tile-header-right">
            <span class="tile-ctrl">
                <a href="/Settings/EmbyStreamsSettings" title="Settings"><i class="fa fa-cog"></i></a>
            </span>
        </span>
    </div>

    <div class="tile-content" id="emby_streams_content">
        <div style="text-align:center; padding: 25px; opacity: 0.5;">
            <i class="fa fa-spinner fa-spin"></i> Loading...
        </div>
    </div>
</div>

<script>
    var embyPollInterval = <?=$interval;?>;
    var embyTimer;

    function updateEmbyStreams() {
        $.get("/plugins/embystreams/embystreams_api.php", function(data) {
            if(data.trim() !== "") {
                $("#emby_streams_content").html(data);
            }
        });
    }

    // Load immediately
    updateEmbyStreams();

    // Prevent duplicate timers if dashboard refreshes
    if (typeof embyTimer !== 'undefined') clearInterval(embyTimer);
    embyTimer = setInterval(updateEmbyStreams, embyPollInterval);
</script>
