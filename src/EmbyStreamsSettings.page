Menu="Settings:Utilities"
Title="Emby Streams"
Icon="emby.png"
---
<?php
$cfg_file = "/boot/config/plugins/embystreams/embystreams.cfg";
$cfg = parse_ini_file($cfg_file);
$message = "";

if ($_POST) {
    // Basic sanitization
    $cfg['HOST'] = preg_replace("/[^0-9.]/", "", $_POST['HOST']);
    $cfg['PORT'] = (int)$_POST['PORT'];
    $cfg['API_KEY'] = trim($_POST['API_KEY']);
    $cfg['POLL_INTERVAL'] = (int)$_POST['POLL_INTERVAL'];
    
    // Save to file
    $content = "";
    foreach ($cfg as $key => $value) {
        $content .= "$key='$value'\n";
    }
    file_put_contents($cfg_file, $content);
    $message = "Settings Saved";
}
?>

<div class="box" style="width: 600px; margin: 20px auto;">
    <?php if ($message): ?>
    <div style="background: #e7f4e4; color: #2d562d; padding: 10px; border-radius: 4px; margin-bottom: 15px; text-align: center;">
        <?=$message?>
    </div>
    <?php endif; ?>

    <form method="POST">
        <dl>
            <dt>Emby Host IP:</dt>
            <dd>
                <input type="text" name="HOST" value="<?=$cfg['HOST'];?>" placeholder="192.168.1.50" required>
                <div class="desc">The local IP address of your Emby server.</div>
            </dd>
            
            <dt>Emby Port:</dt>
            <dd>
                <input type="number" name="PORT" value="<?=$cfg['PORT'];?>" placeholder="8096" required>
                <div class="desc">Default is 8096.</div>
            </dd>
            
            <dt>API Key:</dt>
            <dd>
                <input type="password" name="API_KEY" value="<?=$cfg['API_KEY'];?>" style="width: 100%;" required>
                <div class="desc">Found in Emby Dashboard > Advanced > API Keys.</div>
            </dd>
            
            <dt>Refresh Interval:</dt>
            <dd>
                <input type="number" name="POLL_INTERVAL" value="<?=$cfg['POLL_INTERVAL'];?>" min="1" max="60" style="width: 50px;"> seconds
                <div class="desc">How often the dashboard widget updates.</div>
            </dd>
        </dl>
        
        <div style="text-align: center; margin-top: 20px;">
            <input type="submit" value="Apply" class="literal-button">
            <a href="/Dashboard" class="button">Cancel</a>
        </div>
    </form>
</div>
