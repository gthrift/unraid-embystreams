Menu="Settings:Utilities"
Title="Emby Streams"
Icon="emby.png"
---
<?php
$cfg_file = "/boot/config/plugins/embystreams/embystreams.cfg";
$cfg = parse_ini_file($cfg_file);
$saved = false;

if ($_POST) {
    $cfg['HOST'] = preg_replace("/[^0-9.]/", "", $_POST['HOST']);
    $cfg['PORT'] = (int)$_POST['PORT'];
    $cfg['API_KEY'] = trim($_POST['API_KEY']);
    $cfg['POLL_INTERVAL'] = (int)$_POST['POLL_INTERVAL'];
    
    $content = "";
    foreach ($cfg as $key => $value) {
        $content .= "$key='$value'\n";
    }
    file_put_contents($cfg_file, $content);
    $saved = true;
}
?>

<?php if ($saved): ?>
<script>
    // SweetAlert for better UX than a reload
    swal({
        title: "Saved",
        text: "Configuration updated successfully.",
        type: "success",
        timer: 2000
    });
</script>
<?php endif; ?>

<form markdown="1" method="POST" action="/update.php" target="progressFrame">
    <input type="hidden" name="#file" value="embystreams/embystreams.cfg">
    
    Emby Host IP:
    : <input type="text" name="HOST" value="<?=$cfg['HOST'];?>" placeholder="192.168.1.50" required>
    
    Emby Port:
    : <input type="number" name="PORT" value="<?=$cfg['PORT'];?>" placeholder="8096" required>
    
    API Key:
    : <input type="password" name="API_KEY" value="<?=$cfg['API_KEY'];?>" required style="width: 300px;">
    
    Refresh Interval (seconds):
    : <input type="number" name="POLL_INTERVAL" value="<?=$cfg['POLL_INTERVAL'];?>" min="1" max="60">
    
    <input type="submit" value="Apply">
</form>
